apiVersion: v1
kind: ConfigMap
metadata:
  name: gatus-config
  namespace: joledev
data:
  config.yaml: |
    web:
      port: 8080

    storage:
      type: sqlite
      path: /data/gatus.db

    endpoints:
      - name: "JoleDev Website"
        group: "Frontend"
        url: "https://joledev.com"
        interval: 5m
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 3000"

      - name: "API Quoter"
        group: "APIs"
        url: "http://api-quoter.joledev.svc:8081/health"
        interval: 5m
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 1000"

      - name: "API Scheduler"
        group: "APIs"
        url: "http://api-scheduler.joledev.svc:8082/scheduler/health"
        interval: 5m
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 1000"

      - name: "Status Page"
        group: "Infrastructure"
        url: "https://status.joledev.com"
        interval: 5m
        conditions:
          - "[STATUS] == 200"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gatus
  namespace: joledev
  labels:
    app: gatus
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gatus
  template:
    metadata:
      labels:
        app: gatus
    spec:
      containers:
        - name: gatus
          image: twinproduction/gatus:latest
          ports:
            - containerPort: 8080
          volumeMounts:
            - name: config
              mountPath: /config/config.yaml
              subPath: config.yaml
            - name: data
              mountPath: /data
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 30
          resources:
            requests:
              cpu: 10m
              memory: 32Mi
            limits:
              cpu: 100m
              memory: 64Mi
      volumes:
        - name: config
          configMap:
            name: gatus-config
        - name: data
          emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  name: gatus
  namespace: joledev
spec:
  selector:
    app: gatus
  ports:
    - port: 8080
      targetPort: 8080
