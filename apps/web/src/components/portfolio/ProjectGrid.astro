---
import { getCollection } from 'astro:content';
import ProjectCard from './ProjectCard.svelte';
import ScrollReveal from '../ui/ScrollReveal.svelte';
import TextReveal from '../ui/TextReveal.svelte';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const allProjects = await getCollection('projects');
const projects = allProjects
  .filter((p) => p.data.lang === lang && p.data.featured)
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 4);

const projectsPath = lang === 'es' ? '/es/proyectos/' : '/en/projects/';
---

<section id={lang === 'es' ? 'proyectos' : 'projects'} class="bg-bg-secondary px-4 py-20 sm:px-6 lg:px-8">
  <div class="mx-auto max-w-7xl">
    <div class="text-center">
      <TextReveal
        client:visible
        text={t.sections.featuredProjects}
        tag="h2"
        effect="clipReveal"
        mode="words"
        class="font-display text-3xl font-bold sm:text-4xl"
      />
    </div>

    <div class="mt-14 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {projects.map((project, i) => (
        <ProjectCard
          client:visible
          title={project.data.title}
          description={project.data.description}
          tags={project.data.tags}
          heroImage={project.data.heroImage}
          category={project.data.category}
          slug={project.id}
          lang={lang}
          delay={i * 0.1}
        />
      ))}
    </div>

    <ScrollReveal client:visible delay={0.3}>
      <div class="mt-10 text-center">
        <a
          href={projectsPath}
          class="group inline-flex items-center gap-2 text-sm font-semibold text-accent-primary transition-colors hover:text-accent-light"
        >
          {t.common.viewAllProjects}
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:translate-x-1"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        </a>
      </div>
    </ScrollReveal>
  </div>
</section>
