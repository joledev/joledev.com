---
import { getCollection, render } from 'astro:content';
import BlogLayout from '../../../layouts/BlogLayout.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const enPosts = allPosts
    .filter((p) => p.data.lang === 'en' && !p.data.draft)
    .sort((a, b) => a.data.pubDate.getTime() - b.data.pubDate.getTime());

  return enPosts.map((post, i) => {
    const slug = post.id.replace(/^en\//, '');
    const prev = enPosts[i - 1];
    const next = enPosts[i + 1];
    return {
      params: { slug },
      props: {
        post,
        prevPost: prev ? { slug: prev.id.replace(/^en\//, ''), title: prev.data.title } : null,
        nextPost: next ? { slug: next.id.replace(/^en\//, ''), title: next.data.title } : null,
      },
    };
  });
}

const { post, prevPost, nextPost } = Astro.props;
const { Content, headings } = await render(post);
---

<BlogLayout
  title={post.data.title}
  description={post.data.description}
  pubDate={post.data.pubDate}
  updatedDate={post.data.updatedDate}
  heroImage={post.data.heroImage}
  tags={post.data.tags}
  category={post.data.category}
  headings={headings}
  prevPost={prevPost}
  nextPost={nextPost}
>
  <Content />
</BlogLayout>
